<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ToDoApp.Views.ToDoPage"
             NavigationPage.HasNavigationBar="False">

    <!-- 1️⃣ Resources: DataTemplate for cards -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="CardTemplate">
    <Border
        WidthRequest="300"
        BackgroundColor="Black"
        StrokeThickness="0"
        StrokeShape="RoundRectangle 12"
        Opacity="0.8"
        Margin="5,0,5,5"
        VerticalOptions="Start">

        <Border.Triggers>
            <!-- Make card greener if done -->
            <DataTrigger TargetType="Border"
                         Binding="{Binding IsDone}"
                         Value="True">
                <Setter Property="BackgroundColor" Value="#80006400"/>
            </DataTrigger>
        </Border.Triggers>

        <VerticalStackLayout Padding="15" Spacing="8" HorizontalOptions="Fill" VerticalOptions="Start">
            <Label Text="{Binding Title}" FontSize="26" FontAttributes="Bold" TextColor="White"/>
            <Label Text="{Binding Description}" FontSize="16" TextColor="White"/>

            <HorizontalStackLayout Spacing="10" HorizontalOptions="Fill">
                <!-- Done button hidden if done -->
                <Button Text="Done"
                        Command="{Binding DoneCommand}"
                        CommandParameter="{Binding .}"
                        BackgroundColor="LimeGreen"
                        TextColor="White"
                        FontSize="20"
                        WidthRequest="120">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button"
                                     Binding="{Binding IsDone}"
                                     Value="True">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

                <!-- Delete button always visible -->
                <Button Text="Delete"
                        Command="{Binding DeleteCommand}"
                        CommandParameter="{Binding .}"
                        BackgroundColor="Red"
                        TextColor="White"
                        FontSize="20"
                        WidthRequest="120"/>
            </HorizontalStackLayout>
        </VerticalStackLayout>
    </Border>
</DataTemplate>

        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- 2️⃣ Layout -->
    <Grid ColumnDefinitions="1*,5*"> 

        <!-- Left sidebar -->
        <Grid Grid.Column="0">
            <Border StrokeThickness="0" HorizontalOptions="Fill" VerticalOptions="Fill" BackgroundColor="Transparent">
                <VerticalStackLayout VerticalOptions="Start" HorizontalOptions="Center" Margin="10">
                    <Button Text="New"
                            HorizontalOptions="EndAndExpand"
                            Command="{Binding NewTask}"
                            TextColor="White"
                            FontSize="20"
                            WidthRequest="120"
                            Margin="5,10,5,10"/>
                </VerticalStackLayout>
            </Border>

            <!-- Separator line -->
            <BoxView WidthRequest="1" HorizontalOptions="End" VerticalOptions="Fill" BackgroundColor="Gray"/>
        </Grid>

        <!-- Right side: Cards -->
        <ScrollView Grid.Column="1">
            <FlexLayout
                x:Name="CardsContainer"
                VerticalOptions="Start"
                Direction="Row"
                Wrap="Wrap"
                AlignItems="Start"
                JustifyContent="Start"
                Margin="10"
                BindableLayout.ItemsSource="{Binding Tasks}"
                BindableLayout.ItemTemplate="{StaticResource CardTemplate}">
            </FlexLayout>
        </ScrollView>
    </Grid>
</ContentPage>
